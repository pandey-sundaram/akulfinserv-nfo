name: Auto Update NFO Data

on:
  schedule:
    - cron: "0 2 * * *"   # Runs every day at 2 AM IST
  workflow_dispatch: {}

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.10

    - name: Fetch Latest NFO Data from AMFI
      run: |
        curl -L -o NFO.csv https://www.amfiindia.com/spages/NFO.csv

    - name: Convert CSV to JSON
      run: |
        python3 - << 'EOF'
import csv, json

with open('NFO.csv', 'r', encoding='utf-8') as f:
    data = list(csv.DictReader(f))

final = []
for row in data:
    final.append({
        "status": "open",
        "name": row["Scheme Name"],
        "period": row["NFO Open Date"] + " – " + row["NFO Close Date"],
        "min": "₹" + row["Minimum Purchase"],
        "desc": row["Scheme Objective"],
        "features": [
            row.get("Fund Type", "N/A"),
            row.get("Category", "N/A"),
            "Growth Option Available",
            "AMC: " + row.get("AMC Name", "Unknown")
        ]
    })

with open('nfos.json', 'w', encoding='utf-8') as out:
    json.dump(final, out, indent=4)

EOF

    - name: Commit updates
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "actions@github.com"
        git add nfos.json
        git commit -m "Auto-update NFO data" || echo "No changes"
        git push
